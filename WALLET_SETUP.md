# تعليمات تطبيق نظام المحفظة والدفع الإلكتروني

## 1. تطبيق قاعدة البيانات

قم بتنفيذ الأمر التالي لإنشاء جداول المحفظة:

```bash
# إذا كنت تستخدم MySQL من سطر الأوامر
mysql -u root -p tabibak < backend/database/schema_wallet.sql

# أو يمكنك نسخ محتوى الملف وتنفيذه مباشرة في phpMyAdmin أو MySQL Workbench
```

## 2. التحقق من إنشاء الجداول

بعد تطبيق السكريبت، يجب أن تجد الجداول التالية في قاعدة البيانات:

- `wallets` - محفظة لكل مستخدم
- `transactions` - سجل المعاملات المالية
- `payment_cards` - بطاقات الدفع المحفوظة
- `withdrawal_requests` - طلبات السحب
- `commission_settings` - إعدادات العمولات
- `wallet_activity_log` - سجل نشاط المحفظة

## 3. الوصول إلى المحفظة من التطبيق

### للمرضى والأطباء:
1. افتح التطبيق
2. اذهب إلى "الملف الشخصي"
3. اضغط على "المحفظة والرصيد"

### الميزات المتاحة:

#### شحن الرصيد (Deposit):
- الحد الأدنى: لا يوجد
- طرق الدفع المتاحة:
  - بطاقة ائتمان (رسوم 2%)
  - تحويل بنكي
  - محفظة إلكترونية

#### سحب الرصيد (Withdrawal):
- الحد الأدنى: 100 أوقية
- رسوم السحب: 5 أوقية (ثابتة)
- طرق السحب:
  - تحويل بنكي
  - محفظة إلكترونية
- ملاحظة: طلبات السحب تحتاج موافقة الإدارة

#### سجل المعاملات:
- عرض جميع المعاملات (إيداع، سحب، دفع، استرداد)
- تفاصيل كل معاملة
- الرصيد قبل وبعد كل معاملة
- حالة المعاملة (مكتمل، قيد الانتظار، فشل، ملغي)

#### الإحصائيات:
- إجمالي الإيداعات
- إجمالي السحوبات
- إجمالي المدفوعات
- عدد المعاملات

## 4. واجهات API المتاحة

### الحصول على الرصيد:
```
GET /api/wallet/get_balance.php?user_id={user_id}
```

### إيداع رصيد:
```
POST /api/wallet/deposit.php
Body: {
  "user_id": 1,
  "amount": 500.00,
  "payment_method": "card",
  "description": "شحن رصيد"
}
```

### طلب سحب:
```
POST /api/wallet/withdraw.php
Body: {
  "user_id": 1,
  "amount": 200.00,
  "withdrawal_method": "bank_transfer",
  "bank_name": "البنك الوطني",
  "account_number": "123456789",
  "account_holder_name": "أحمد محمد"
}
```

### الحصول على المعاملات:
```
GET /api/wallet/get_transactions.php?user_id={user_id}&limit=50&offset=0
```

## 5. ملاحظات مهمة

- يتم إنشاء محفظة تلقائياً لكل مستخدم جديد برصيد 0.00
- جميع المعاملات مسجلة مع IP address و User agent للأمان
- العملة المستخدمة: أوقية موريتانية (MRU)
- رمز العملة: أ.م

## 6. التطوير المستقبلي

يمكن إضافة:
- ربط بوابات دفع حقيقية (Stripe, PayPal, إلخ)
- نظام إشعارات للمعاملات
- تقارير مالية متقدمة
- دعم عملات متعددة
- نظام cashback ومكافآت
